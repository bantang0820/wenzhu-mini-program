# 稳住小程序 - 登录与付费功能实施指南

## 📦 已完成的代码

✅ 登录页面（pages/login/login）
✅ 登录云函数（cloud/functions/login）
✅ 保存用户信息云函数（cloud/functions/saveUserInfo）
✅ 检查会员状态云函数（cloud/functions/checkMembership）
✅ 获取会员信息云函数（cloud/functions/getMembershipInfo）
✅ 会员检查工具函数（utils/membership.js）

---

## 📝 接下来你需要做的步骤

### 第一步：开通云开发（10分钟）

1. **登录小程序后台**
   - 访问：https://mp.weixin.qq.com/
   - 扫码登录

2. **开通云开发**
   - 点击左侧菜单"云开发"
   - 点击"开通"按钮
   - 选择"按量付费"模式（有免费额度）
   - 点击"开通"

3. **创建环境**
   - 环境名称：`prod`（生产环境）
   - 环境名称：`dev`（开发环境，可选）
   - 记录下你的**环境ID**（类似：cloud1-xxx）

4. **初始化数据库**
   - 在云开发控制台，点击"数据库"
   - 创建以下集合（表）：
     - `users` - 用户信息
     - `memberships` - 会员信息
     - `orders` - 订单信息

5. **配置数据库权限**
   - 在"数据库" → "设置" → "权限设置"
   - 将所有集合的权限设置为"所有用户可读，仅创建者可写"

---

### 第二步：上传云函数（5分钟）

1. **打开微信开发者工具**

2. **云函数控制台**
   - 点击"云开发"按钮
   - 选择你的环境（prod）

3. **上传云函数**
   依次上传以下云函数：
   - `login` - 登录
   - `saveUserInfo` - 保存用户信息
   - `checkMembership` - 检查会员状态
   - `getMembershipInfo` - 获取会员信息

   每个云函数：
   - 右键点击云函数文件夹
   - 选择"上传并部署：云端安装依赖"
   - 等待上传完成

---

### 第三步：修改项目配置（1分钟）

1. **获取环境ID**
   - 在云开发控制台查看你的环境ID
   - 类似：`cloud1-xxx`

2. **修改 app.js**
   ```javascript
   // 在 App() 的 onLaunch 中添加
   wx.cloud.init({
     env: '你的环境ID', // 替换成你的环境ID
     traceUser: true
   });
   ```

---

### 第四步：测试登录功能（2分钟）

1. **编译运行**
   - 在微信开发者工具点击"编译"

2. **测试登录**
   - 应该会自动跳转到登录页面
   - 点击"微信授权登录"
   - 确认授权
   - 应该会跳转到首页

3. **查看数据库**
   - 在云开发控制台 → 数据库
   - 查看 `users` 集合
   - 应该能看到你的用户信息

---

### 第五步：注册企业并开通微信支付（1-3天）

**如果你已经有公司**：

1. **准备材料**
   - 营业执照照片
   - 法人身份证照片
   - 对公账户信息
   - 小程序AppID

2. **注册微信支付商户号**
   - 访问：https://pay.weixin.qq.com/
   - 点击"立即接入"
   - 选择"小程序"
   - 填写企业信息
   - 上传资料
   - 等待审核（1-3天）

3. **绑定小程序**
   - 审核通过后
   - 在商户平台关联你的小程序
   - 配置API密钥

---

### 第六步：实现支付功能（审核通过后）

等微信支付审核通过后，我会帮你完成：
- 创建订单云函数
- 支付回调处理
- 会员权益控制

---

## 🔧 常见问题

### Q1：云开发免费额度是多少？
A：
- 数据库读：5000次/天
- 数据库写：3000次/天
- 文件存储：5GB
- CDN流量：5GB/月

**足够日活<1000的小程序使用**

### Q2：如何查看云函数日志？
A：
- 云开发控制台 → 云函数
- 点击云函数名称
- 查看"日志"

### Q3：用户信息存在哪里？
A：
- 存在云数据库中
- 数据所有权100%归你
- 可随时导出备份

### Q4：测试时可以用假支付吗？
A：
- 可以！微信支付提供沙箱环境
- 用于测试，不扣真钱
- 审核通过后再切换到正式环境

---

## 📞 下一步

完成上面的步骤后，告诉我：

1. ✅ 云开发已开通，环境ID是：________
2. ✅ 云函数已上传
3. ✅ 登录功能已测试成功

然后我会帮你实现支付功能！

---

## 💡 提示

- **云函数上传失败**：确保网络稳定，多试几次
- **登录报错**：检查云函数是否正确上传
- **数据库权限问题**：按照步骤配置权限
- **环境ID错误**：在云开发控制台复制正确的环境ID

有任何问题随时告诉我！
