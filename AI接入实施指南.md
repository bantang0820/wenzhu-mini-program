# AI驱动的情绪切片生成 - 实施指南

## 🎯 功能概述

通过接入DeepSeek等大模型API，实现**千人千面**的个性化情绪切片文案生成，让每次生成的卡片都独一无二。

---

## ✨ 核心优势

### 与静态文案库对比

| 维度 | 静态文案库 | AI动态生成 |
|------|-----------|-----------|
| **内容数量** | 几百条，容易重复 | 无限生成，永不重复 |
| **个性化** | 固定模板 | 根据心情、时间实时生成 |
| **新鲜感** | 用几次就腻 | 每次都有开盲盒的感觉 |
| **开发成本** | 需要大量手写文案 | 一套Prompt搞定 |
| **用户体验** | 机械感 | "它真的懂我" |
| **维护成本** | 需要持续更新 | 零维护 |

### 成本分析

**DeepSeek API定价**（2025年1月）：
- 输入：¥0.001 / 1K tokens
- 输出：¥0.002 / 1K tokens
- 单次生成约500 tokens
- **单次成本：约¥0.001（0.1元）**

**月成本估算**：
- 假设日活1000人，每人生成1次
- 月成本：1000 × 30 × 0.001 = **¥30/月**

**结论**：成本极低，完全可以忽略不计！

---

## 📋 实施步骤

### 第一步：获取DeepSeek API Key

1. **注册DeepSeek账号**
   - 访问：https://platform.deepseek.com/
   - 手机号注册

2. **创建API Key**
   - 进入"API Keys"页面
   - 点击"创建API Key"
   - 复制保存API Key

3. **充值（可选）**
   - 新用户有免费额度
   - 充值最小金额：¥10（够用很久）

### 第二步：配置云函数

1. **上传云函数**
   - 在微信开发者工具中
   - 右键 `cloud/functions/generateEmotionalSlice`
   - 选择"上传并部署：云端安装依赖"

2. **配置环境变量**
   - 进入云开发控制台
   - 云函数 → generateEmotionalSlice
   - 配置 → 环境变量
   - 添加：`DEEPSEEK_API_KEY = 你的API密钥`

### 第三步：测试功能

1. **编译运行小程序**
2. **完成三句朗读**
3. **点击"稳住了"**
4. **选择心情词**（如：差点炸了）
5. **等待AI生成**（2-3秒）
6. **查看生成的卡片**

---

## 🔧 技术细节

### 交互流程

```
用户点击"稳住了"
  ↓
显示心情词选择界面
  ↓
用户选择心情词（如：🔥 差点炸了）
  ↓
显示"AI正在书写..."
  ↓
调用云函数 generateEmotionalSlice
  ↓
云函数调用DeepSeek API
  ↓
返回AI生成的三段式文案
  ↓
跳转到卡片页面
  ↓
展示AI生成的个性化情绪切片
```

### 超时兜底策略

**如果AI超时或失败**：
- 3秒后自动使用本地文案
- 保证用户体验不中断
- 用户无感知切换

### Prompt设计亮点

**核心原则**：
1. **Show, Don't Tell**：不要说"我很生气"，要说"我的太阳穴突突直跳"
2. **活人感**：口语化，像备忘录里随手记下的
3. **高级感**：避免陈词滥调，使用画面感强的隐喻
4. **禁止说教**：写给自己的，不是给别人看的

---

## 📊 实际效果示例

### 输入
- **场景**：辅导作业
- **心情**：心寒无力
- **时间**：20:30

### AI输出

```json
{
  "time_start": "20:25",
  "phase_1_text": "橡皮擦屑铺满了桌角，同一道题讲了三遍，他眼里依然是一片茫然。我的心像掉进了冰窖。",
  "time_mid": "20:30",
  "phase_2_text": "我合上了作业本，起身去厨房倒了一杯温水。透过玻璃杯升起的雾气，我看到了自己紧皱的眉头。",
  "time_end": "此刻",
  "phase_3_insight": "接纳他的平凡，也就是接纳我自己的平凡。"
}
```

### 生成后的卡片

```
┌─────────────────────────────┐
│ [JAN 18]                    │
│                             │
│  ● ┄ ┄ ┄ ┄ ┄                │
│                             │
│  20:25 · 混乱                │
│  橡皮擦屑铺满了桌角，同一道    │
│  题讲了三遍，他眼里依然是一片   │
│  茫然。我的心像掉进了冰窖。    │
│                             │
│  20:28 · 暂停                │
│  我合上了作业本，起身去厨房倒   │
│  了一杯温水。透过玻璃杯升起    │
│  的雾气，我看到了自己紧皱的     │
│  眉毛。                       │
│                             │
│  20:30 · 看见                │
│  **接纳他的平凡，也就是接纳     │
│  **我自己的平凡。**            │
│                             │
│                      — 小明   │
└─────────────────────────────┘
```

---

## 🎁 额外收益

### 1. 用户粘性提升
- 每次生成的文案都不一样
- 开盲盒般的期待感
- 用户愿意多次使用

### 2. 分享率提升
- 个性化内容更值得分享
- 朋友圈展示"真实的自己"
- 自然带出品牌

### 3. 零维护成本
- 不需要持续更新文案库
- 一套Prompt自动生成
- 模型会持续优化

### 4. 数据洞察
- 可以收集用户选择的心情词
- 分析用户情绪分布
- 优化产品功能

---

## 💡 优化空间

### 阶段一：基础版（已实现）
- ✅ 3个心情词选择
- ✅ DeepSeek API接入
- ✅ 本地文案兜底

### 阶段二：优化版（可选）
- 添加更多心情词（5-7个）
- 支持自定义心情词
- 添加时间显示（晨间/午后/夜间）
- 根据时间段调整Prompt

### 阶段三：高级版（未来）
- 接入天气API，添加天气元素
- 记录用户历史，生成月度情绪报告
- 允许用户编辑AI生成的文案
- 支持语音转文字生成

---

## ⚠️ 注意事项

### 1. API Key安全
- ✅ 不要把API Key写在前端代码中
- ✅ 使用云函数环境变量
- ✅ 定期更换API Key

### 2. 成本控制
- ✅ 设置单日生成次数上限（如：10次/天）
- ✅ 会员可无限次生成
- ✅ 免费用户3次/天

### 3. 超时处理
- ✅ 设置3秒超时
- ✅ 超时自动使用本地文案
- ✅ 用户无感知切换

### 4. 内容审核
- ✅ 监控AI生成内容
- ✅ 建立敏感词过滤
- ✅ 用户举报机制

---

## 🚀 立即开始

1. **注册DeepSeek**：https://platform.deepseek.com/
2. **获取API Key**：在控制台创建
3. **配置云函数**：设置环境变量
4. **上传云函数**：在开发者工具中上传
5. **测试功能**：运行小程序测试

**预计时间**：30分钟完成配置！

---

## 📞 技术支持

如果遇到问题：
1. 检查API Key是否正确配置
2. 查看云函数日志
3. 检查DeepSeek账户余额
4. 测试API调用是否成功

---

**用AI给用户无限的惊喜！** 🎨✨
