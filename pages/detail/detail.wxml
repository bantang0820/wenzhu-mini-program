<!--pages/detail/detail.wxml - åŸç ”å“‰å¼æç®€ä¸»ä¹‰å®Œæ•´ç‰ˆ-->
<view class="container {{isDarkMode ? 'dark-mode' : ''}} {{currentPhase === 'reading' ? 'reading-mode' : ''}}" style="background-color: rgba(235, 234, 230, {{backgroundBrightness / 100}})">
  <!-- èƒ½é‡æç¤ºï¼ˆé¡¶éƒ¨ï¼Œä¸é®æŒ¡æ–‡å­—ï¼‰ -->
  <view class="energy-toast {{showEnergyToast ? 'show' : ''}}" wx:if="{{showEnergyToast}}">
    <text class="energy-toast-text">{{energyToastText}}</text>
  </view>

  <!-- è¤ç«è™«ç²’å­æ•ˆæœ -->
  <view class="fireflies-container" wx:if="{{currentPhase === 'reading'}}">
    <view class="firefly" style="top: 10%; left: 15%;"></view>
    <view class="firefly" style="top: 20%; left: 80%;"></view>
    <view class="firefly" style="top: 35%; left: 25%;"></view>
    <view class="firefly" style="top: 45%; left: 70%;"></view>
    <view class="firefly" style="top: 60%; left: 40%;"></view>
    <view class="firefly" style="top: 75%; left: 60%;"></view>
    <view class="firefly" style="top: 15%; left: 50%;"></view>
    <view class="firefly" style="top: 30%; left: 90%;"></view>
    <view class="firefly" style="top: 55%; left: 10%;"></view>
    <view class="firefly" style="top: 65%; left: 85%;"></view>
    <view class="firefly" style="top: 85%; left: 30%;"></view>
    <view class="firefly" style="top: 5%; left: 65%;"></view>
    <view class="firefly" style="top: 50%; left: 55%;"></view>
    <view class="firefly" style="top: 25%; left: 5%;"></view>
    <view class="firefly" style="top: 40%; left: 95%;"></view>
  </view>

  <!-- èƒ½é‡å…‰æ™•ï¼ˆæ ¹æ®å£°éŸ³å¼ºåº¦å˜åŒ–ï¼‰ -->
  <view class="energy-glow {{isRecording ? 'active' : ''}}" style="transform: translate(-50%, -50%) scale({{energyScale || 1}});"></view>

  <!-- è¿”å›æŒ‰é’® -->
  <view class="back-btn neumorphism-convex" bindtap="onBack" wx:if="{{!isCompleted}}">
    <text class="back-icon">âœ•</text>
  </view>

  <!-- åœºæ™¯æ ‡é¢˜ -->
  <view class="scenario-header" wx:if="{{!isCompleted}}">
    <text class="scenario-tag">ç¨³ä½</text>
  </view>

  <!-- ç¬¬ä¸€é˜¶æ®µï¼šé•¿æŒ‰æ­¢é¢¤ -->
  <view class="phase-hold" wx:if="{{currentPhase === 'holding'}}">
    <!-- é‡‘å¥å±•ç¤ºåŒºï¼ˆé¢¤æŠ–ä¸­ï¼‰ -->
    <view class="quote-container {{isStabilized ? 'stabilized' : 'shake-animation'}} {{isStabilizing && !isStabilized ? 'stabilizing' : ''}}">
      <text class="quote-text-base title-serif">{{currentText}}</text>
      <text class="quote-text-black title-serif">{{currentText}}</text>
      <text class="quote-text-gold title-serif">{{currentText}}</text>
    </view>

    <!-- é•¿æŒ‰æŒ‰é’® -->
    <view class="hold-button-wrapper">
      <!-- è¿›åº¦æç¤ºï¼ˆæŒ‰é’®æ­£ä¸Šæ–¹ï¼‰ -->
      <view class="progress-hint">
        <text>æŒ‰ä½ä¸‹æ–¹æŒ‰é’®ï¼Œç¨³ä½</text>
      </view>

      <view
        class="hold-button accent-button {{isHolding ? 'holding' : ''}} {{isStabilized ? 'stabilized-btn' : ''}}"
        bindtouchstart="onHoldStart"
        bindtouchend="onHoldEnd"
        bindtap="{{isStabilized ? 'onStabilizedClick' : ''}}"
      >
        <text class="hold-text">{{isStabilized ? 'å·²ç¨³ä½' : 'æŒ‰ä½'}}</text>
        <text class="hold-sub" wx:if="{{!isStabilized}}">{{holdProgress}}%</text>
      </view>
    </view>
  </view>

  <!-- ç¬¬äºŒé˜¶æ®µï¼šä¸‰è½®æœ—è¯» -->
  <view class="phase-reveal {{showGuide ? 'show' : ''}}" wx:if="{{currentPhase === 'reading'}}">
    <!-- è½®æ¬¡è¿›åº¦ç¯ -->
    <view class="round-progress">
      <view class="progress-ring">
        <view class="progress-dot" wx:for="{{[1,2,3]}}" wx:key="index" style="opacity: {{index <= readingRound ? 1 : 0.3}}"></view>
      </view>
      <text class="round-label">0{{readingRound}}</text>
    </view>

    <!-- é‡‘å¥å®¹å™¨ -->
    <view class="quote-reveal-container">
      <text class="quote-reveal-text title-serif typewriter shimmer">{{displayText}}</text>
    </view>

    <!-- å½•éŸ³æŒ‰é’®ï¼ˆå»¶è¿Ÿæ˜¾ç¤ºï¼‰ -->
    <view class="stamp-section" wx:if="{{showStamp}}">
      <!-- å½•éŸ³æŒ‰é’® -->
      <view class="stamp-wrapper">
        <!-- æœªå½•éŸ³çŠ¶æ€ï¼šæ˜¾ç¤ºå½•éŸ³æŒ‰é’® -->
        <view
          wx:if="{{!hasRecorded}}"
          class="record-button {{isRecording ? 'recording' : ''}}"
          bindtouchstart="onRecordStart"
          bindtouchend="onRecordEnd"
        >
          <text class="record-icon">{{isRecording ? 'ğŸ”´' : 'ğŸ¤'}}</text>
          <text class="record-label">{{isRecording ? 'å½•éŸ³ä¸­...' : 'æŒ‰ä½æœ—è¯»'}}</text>
        </view>

        <!-- å·²å½•éŸ³çŠ¶æ€ï¼šæ˜¾ç¤ºå›æ”¾æŒ‰é’®å’Œç¡®è®¤æŒ‰é’® -->
        <view wx:else class="playback-buttons">
          <!-- å›æ”¾æŒ‰é’® -->
          <view
            class="play-button {{isPlaying ? 'playing' : ''}}"
            bindtap="onPlayRecord"
          >
            <text class="play-icon">{{isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}}</text>
            <text class="play-label">{{isPlaying ? 'æ’­æ”¾ä¸­' : 'å›å¬'}}</text>
          </view>

          <!-- ç¡®è®¤æŒ‰é’® -->
          <view class="confirm-button" bindtap="onConfirmRecord">
            <text class="confirm-icon">âœ“</text>
            <text class="confirm-label">å®Œæˆ</text>
          </view>
        </view>
      </view>

      <!-- å¼•å¯¼è¯­ï¼ˆå½•éŸ³æŒ‰é’®ä¸‹æ–¹ï¼‰ -->
      <view class="guide-text-container" wx:if="{{showGuide && !hasRecorded}}">
        <text class="guide-text">{{guideText}}</text>
      </view>
    </view>
  </view>

  <!-- æ²»æ„ˆåˆ†äº«å¡ç‰‡ -->
  <view class="healing-card-modal {{showHealingCard ? 'show' : ''}}" wx:if="{{showHealingCard}}">
    <view class="healing-content">
      <!-- é¡¶éƒ¨å›¾æ ‡ -->
      <view class="healing-icon">
        <text>âœ¨</text>
      </view>

      <!-- æ²»æ„ˆçš„è¯ -->
      <view class="healing-quote">
        <text class="healing-text title-serif">{{healingQuote}}</text>
      </view>

      <!-- æ¸©æš–çš„æç¤º -->
      <view class="healing-hint">
        <text>æŠŠè¿™ä»½æ¸©æš–ï¼Œåˆ†äº«ç»™éœ€è¦çš„äºº</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="healing-buttons">
        <!-- åˆ†äº«æŒ‰é’® -->
        <view class="healing-btn healing-share" bindtap="onShareFromHealing">
          <text class="healing-btn-icon">âœˆï¸</text>
          <text class="healing-btn-label">åˆ†äº«ç»™æœ‹å‹æˆ–é˜Ÿå‹</text>
        </view>

        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <view class="healing-btn healing-home" bindtap="onBackHomeFromHealing">
          <text class="healing-btn-icon">ğŸ </text>
          <text class="healing-btn-label">è¿”å›é¦–é¡µ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¬¬å››é˜¶æ®µï¼šæ¶Ÿæ¼ªï¼ˆå®Œæˆå¡ç‰‡ï¼‰ -->
  <view class="phase-completed {{showCompleted ? 'show' : ''}}" wx:if="{{currentPhase === 'completed'}}">
    <!-- å¡ç‰‡å®¹å™¨ -->
    <view class="completed-card">
      <!-- é‡‘å¥ -->
      <view class="card-quote">
        <text class="card-quote-text title-serif">{{currentText}}</text>
      </view>

      <!-- æ—¥æœŸå°ç«  -->
      <view class="date-stamp">
        <text class="date-text">{{currentDate}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®ç»„ -->
    <view class="action-buttons">
      <!-- åˆ†äº«æŒ‰é’®ï¼ˆçº¸é£æœºï¼‰ -->
      <view class="action-btn neumorphism-convex" bindtap="onShare">
        <text class="action-icon">âœˆï¸</text>
        <text class="action-label">åˆ†äº«ç»™é˜Ÿå‹</text>
      </view>

      <!-- è¿”å›æŒ‰é’®ï¼ˆæˆ¿å­ï¼‰ -->
      <view class="action-btn neumorphism-convex" bindtap="onBackHome">
        <text class="action-icon">ğŸ </text>
        <text class="action-label">è¿”å›é¦–é¡µ</text>
      </view>
    </view>

    <!-- ä¼šå‘˜å¼•å¯¼ -->
    <view class="member-guide">
      <view class="guide-text">
        <text class="guide-emoji">ğŸ”“</text>
        <text class="guide-title">è§£é”å…¨éƒ¨21ä¸ªåœºæ™¯</text>
        <text class="guide-desc">æ¶µç›–è‚²å„¿è·¯ä¸Šçš„å„ç§æŒ‘æˆ˜</text>
      </view>
    </view>
  </view>

  <!-- æ¶Ÿæ¼ªæ•ˆæœ -->
  <view class="ripple-container" wx:if="{{showRipple}}">
    <view class="ripple"></view>
  </view>
</view>