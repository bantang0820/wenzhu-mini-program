<!--pages/stats/stats.wxml - 觉察-->
<view class="container">
  <!-- ========== 顶部：核心数据 ========== -->
  <view class="hero-section">
    <text class="hero-label">已 稳 住</text>
    <text class="hero-number">{{totalDays}}</text>
    <text class="hero-unit">天</text>

    <view class="hero-stats">
      <text class="stats-text">累计获得 {{totalEnergy}} 能量 | 击败了 {{beatPercent}}% 的焦虑</text>
    </view>
  </view>

  <!-- ========== 心灵状态（原等级进度） ========== -->
  <view class="state-section">
    <view class="state-header">
      <text class="state-current">{{userInfo.levelName}}</text>
    </view>

    <view class="state-progress-box">
      <view class="state-progress-bar">
        <view class="state-progress-fill" style="width: {{userInfo.progress}}%;"></view>
        <!-- 呼吸感的光点 -->
        <view class="progress-glow" style="left: {{userInfo.progress}}%;"></view>
      </view>
      
      <view class="state-hint" wx:if="{{userInfo.nextLevelName}}">
        再修习 <text class="highlight">{{userInfo.remainingDays}}</text> 天，遇见 <text class="highlight">{{userInfo.nextLevelName}}</text>
      </view>
      <view class="state-hint" wx:else>
        您已达到最平和安稳的状态
      </view>
    </view>
  </view>

  <!-- ========== 中部：修习日历 ========== -->
  <view class="calendar-section">
    <view class="section-header">
      <text class="section-title">{{currentYear}}年{{currentMonth}}月</text>
    </view>

    <view class="calendar-grid">
      <view
        class="calendar-day {{item.isToday ? 'today' : ''}} {{item.isCheckedIn ? 'checked' : ''}}"
        wx:for="{{calendarDays}}"
        wx:key="dateStr"
        bindtap="onDateTap"
        data-date-str="{{item.dateStr}}"
        data-is-checked-in="{{item.isCheckedIn}}"
      >
        <text class="day-number">{{item.day}}</text>
        <view class="golden-energy-ball" wx:if="{{item.isCheckedIn}}"></view>
      </view>
    </view>

    <view class="calendar-legend">
      <view class="legend-item">
        <view class="legend-dot"></view>
        <text class="legend-text">未打卡</text>
      </view>
      <view class="legend-item">
        <view class="golden-energy-ball legend-marker"></view>
        <text class="legend-text">已修习</text>
      </view>
    </view>
  </view>

  <!-- ========== 底部：勋章墙 ========== -->
  <view class="medal-section">
    <view class="section-header">
      <text class="section-title">获得的勋章</text>
    </view>

    <!-- 已获得的勋章 -->
    <view class="medal-grid" wx:if="{{medals.length > 0}}">
      <view
        class="medal-item unlocked"
        wx:for="{{medals}}"
        wx:key="id"
      >
        <text class="medal-icon">{{item.icon}}</text>
        <text class="medal-name">{{item.name}}</text>
      </view>
    </view>

    <view class="empty-medals" wx:else>
      <text class="empty-text">还没有获得勋章，继续坚持吧</text>
    </view>

    <!-- 未获得的勋章 -->
    <view class="medal-grid locked" wx:if="{{lockedMedals.length > 0}}">
      <view
        class="medal-item locked"
        wx:for="{{lockedMedals}}"
        wx:key="id"
        bindtap="onMedalTap"
        data-locked="{{true}}"
      >
        <text class="medal-icon locked-icon">◑</text>
        <text class="medal-name">{{item.name}}</text>
        <text class="medal-desc">{{item.desc}}</text>
      </view>
    </view>
  </view>
</view>
