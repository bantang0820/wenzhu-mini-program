<!--pages/chapter/chapter.wxml - ç« èŠ‚è¯¦æƒ…é¡µï¼ˆå¾®è¯¾æ¨¡å¼ï¼‰-->
<view class="container">
  <!-- ========== ï¿½oidagemå¤´éƒ¨ ========== -->
  <view class="chapter-header">
    <view class="chapter-meta">
      <text class="chapter-number">ç¬¬ {{chapter.id}} ç« </text>
      <view class="chapter-divider">|</view>
      <text class="chapter-progress">{{completedCount}}/10 å°èŠ‚</text>
    </view>
    <text class="chapter-title">{{chapter.title}}</text>
    <text class="chapter-subtitle">{{chapter.subtitle}}</text>
  </view>

  <!-- ========== æ¯æ—¥å¾®è¯¾åˆ—è¡¨ ========== -->
  <view class="lessons-section">
    <view class="lesson-card" wx:for="{{lessons}}" wx:key="id" bindtap="onLessonTap" data-id="{{item.id}}">
      <!-- å¾®è¯¾åºå· -->
      <view class="lesson-number {{item.completed ? 'completed' : ''}}">
        <text class="number-text">{{item.id}}</text>
      </view>

      <!-- å¾®è¯¾å†…å®¹ -->
      <view class="lesson-content">
        <!-- ç ´ï¼šé‡‘å¥æ ‡é¢˜ -->
        <view class="lesson-breakthrough">
          <text class="breakthrough-icon">ğŸ’¡</text>
          <text class="breakthrough-text">{{item.breakthrough}}</text>
        </view>

        <!-- ç«‹ï¼šè§£è¯»ï¼ˆç¬¬ä¸€æ®µï¼‰-->
        <text class="lesson-insight">{{item.insight}}</text>

        <!-- è¡Œï¼šè¡ŒåŠ¨å»ºè®® -->
        <view class="lesson-action" wx:if="{{item.action}}">
          <text class="action-icon">ğŸ¯</text>
          <text class="action-text">{{item.action}}</text>
        </view>

        <!-- å®ŒæˆçŠ¶æ€ -->
        <view class="lesson-status">
          <text class="status-text">{{item.completed ? 'å·²å®Œæˆ' : 'å¾…å®Œæˆ'}}</text>
          <text class="status-icon">{{item.completed ? 'âœ“' : 'â—‹'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ========== åº•éƒ¨å®ŒæˆæŒ‰é’® ========== -->
  <view class="footer-action" wx:if="{{completedCount >= 6}}">
    <view class="complete-chapter-btn" bindtap="onCompleteChapter">
      <text class="btn-main-text">å®Œæˆæœ¬ç« èŠ‚</text>
      <text class="btn-sub-text">è§£é”ä¸‹ä¸€ç« </text>
    </view>
  </view>
</view>

<!-- ========== è‡ªå®šä¹‰å¾®è¯¾è¯¦æƒ…å¼¹çª— ========== -->
<view class="lesson-modal" wx:if="{{showLessonModal}}" catchtap="onCloseModal">
  <view class="modal-content" catchtap="stopPropagation">
    <!-- å…³é—­æŒ‰é’® -->
    <view class="modal-close" bindtap="onCloseModal">
      <text class="close-icon">Ã—</text>
    </view>

    <!-- å¼¹çª—å†…å®¹ -->
    <scroll-view class="modal-scroll" scroll-y>
      <!-- ç ´ï¼šé‡‘å¥ -->
      <view class="modal-section breakthrough-section">
        <view class="section-label">ğŸ’¡ è§‰é†’</view>
        <text class="breakthrough-title">{{currentLesson.breakthrough}}</text>
      </view>

      <!-- ç«‹ï¼šè§£è¯» -->
      <view class="modal-section insight-section">
        <view class="section-label">ğŸ“– é¢†æ‚Ÿ</view>
        <text class="insight-text">{{currentLesson.insight}}</text>
      </view>

      <!-- è¡Œï¼šè¡ŒåŠ¨ -->
      <view class="modal-section action-section">
        <view class="section-label">ğŸ¯ å®è·µ</view>
        <text class="action-text-full">{{currentLesson.action}}</text>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="modal-actions">
      <view class="action-btn practice-btn-full" bindtap="onPracticeLesson">
        <text class="btn-icon">ğŸ™ï¸</text>
        <text class="btn-label">æœ—è¯»</text>
      </view>
      <view class="action-btn complete-btn-full {{currentLesson.completed ? 'completed' : ''}}" bindtap="onToggleComplete">
        <text class="btn-icon">{{currentLesson.completed ? 'âœ“' : 'â—‹'}}</text>
        <text class="btn-label">{{currentLesson.completed ? 'å·²å®Œæˆ' : 'æ ‡è®°å®Œæˆ'}}</text>
      </view>
    </view>
  </view>
</view>
