<!--pages/lesson/lesson.wxml - å¾®è¯¾è¯¦æƒ…é¡µ-->
<view class="container">
  <!-- ========== è¿”å›æŒ‰é’® ========== -->
  <view class="back-btn" bindtap="onBack">
    <text class="back-icon">â†</text>
    <text class="back-text">è¿”å›ç« èŠ‚</text>
  </view>

  <!-- ========== å¾®è¯¾å¡ç‰‡ ========== -->
  <view class="lesson-card">
    <!-- å¾®è¯¾åºå· -->
    <view class="lesson-badge">
      <text class="badge-text">ç¬¬{{lessonId}}å°èŠ‚</text>
    </view>

    <!-- æ ‡é¢˜ -->
    <view class="lesson-title">
      <text class="title-text">{{lesson.breakthrough}}</text>
    </view>

    <!-- æ ¸å¿ƒå†…å®¹ -->
    <view class="lesson-content">
      <text class="content-text">{{lesson.insight}}</text>
    </view>

    <!-- å®è·µåŠ¨ä½œ -->
    <view class="lesson-action">
      <view class="action-label">å®è·µ</view>
      <text class="action-text">{{lesson.action}}</text>
    </view>
  </view>

  <!-- ========== æœ—è¯»æŒ‰é’®åŒº ========== -->
  <view class="reading-section">
    <!-- å½•éŸ³çŠ¶æ€æç¤º -->
    <view class="recording-status" wx:if="{{isRecording}}">
      <text class="status-text">æ­£åœ¨å½•éŸ³...</text>
    </view>

    <!-- å½•éŸ³æŒ‰é’® -->
    <view class="record-btn-wrapper">
      <!-- èƒ½é‡å…‰æ™• -->
      <view class="energy-halo" style="transform: scale({{energyScale}}); opacity: {{isRecording ? 1 : 0}}"></view>

      <!-- å½•éŸ³æŒ‰é’® -->
      <view
        class="record-btn-main {{isRecording ? 'recording' : ''}}"
        bindtap="onRecordClick"
      >
        <text class="record-btn-icon">{{isRecording ? 'ğŸ”´' : 'ğŸ™ï¸'}}</text>
        <text class="record-btn-text">{{isRecording ? 'ç‚¹å‡»åœæ­¢' : 'ç‚¹å‡»æœ—è¯»'}}</text>
      </view>
    </view>

    <!-- å›æ”¾æŒ‰é’®ï¼ˆå½•éŸ³å®Œæˆåæ˜¾ç¤ºï¼‰ -->
    <view class="playback-section" wx:if="{{hasRecorded && !isRecording}}" bindtap="onPlayRecord">
      <text class="playback-icon">{{isPlaying ? 'â¸' : 'â–¶ï¸'}}</text>
      <text class="playback-text">{{isPlaying ? 'æš‚åœ' : 'å›æ”¾å½•éŸ³'}}</text>
    </view>
  </view>

  <!-- ========== åº•éƒ¨æŒ‰é’®åŒº ========== -->
  <view class="bottom-actions {{lessonId >= totalLessons ? 'single-btn' : ''}}">
    <view class="bottom-btn mark-btn" bindtap="onMarkComplete">
      <text class="bottom-icon">{{lesson.completed ? 'âœ“' : 'â—‹'}}</text>
      <text class="bottom-text">æ ‡è®°å®Œæˆ</text>
    </view>

    <view class="bottom-btn next-btn" bindtap="onNextLesson" wx:if="{{lessonId < totalLessons}}">
      <text class="bottom-icon">â†’</text>
      <text class="bottom-text">å­¦ä¹ ä¸‹ä¸€èŠ‚ ({{lessonId + 1}}/{{totalLessons}})</text>
    </view>
  </view>
</view>
